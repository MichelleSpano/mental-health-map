<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Exclusion vs Mental Health - England</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 28px; }
        .header p { margin: 10px 0 0 0; font-size: 16px; opacity: 0.9; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .map-box { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; overflow: hidden; position: relative; }
        #map { height: 600px; width: 100%; }
        .legend { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: inline-block; }
        .legend h4 { margin: 0 0 15px 0; text-align: center; }
        .legend-grid { display: grid; grid-template-columns: auto repeat(3, 30px); gap: 3px; align-items: center; }
        .legend-cell { width: 30px; height: 30px; border: 1px solid black; }
        .legend-label { text-align: center; font-size: 12px; }
        .insights { display: grid; gap: 15px; margin-top: 20px; }
        .insight { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .insight h4 { margin: 0 0 10px 0; color: #333; }
        .stats { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; z-index: 1000; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="header">
        <h1>Social Exclusion vs Mental Health</h1>
        <p>England Local Authorities - Interactive Choropleth Map</p>
    </div>
    
    <div class="container">
        <div class="stats">
            <p><strong>Complete Dataset:</strong> 293 Local Authorities | <strong>Total Sample:</strong> 18,273 participants</p>
            <p><em>Click on any area to see detailed information</em></p>
        </div>
        
        <div class="map-box">
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <div>Loading boundary data...</div>
            </div>
            <div id="map"></div>
        </div>
        
        <div class="legend">
            <h4>Social Exclusion vs Mental Health</h4>
            <div class="legend-grid">
                <div></div>
                <div class="legend-label">Low</div>
                <div class="legend-label">Med</div>
                <div class="legend-label">High</div>
                
                <div style="writing-mode: vertical-rl; font-size: 12px;">Poor MH</div>
                <div class="legend-cell" style="background: #d477a4;"></div>
                <div class="legend-cell" style="background: #ad6aaa;"></div>
                <div class="legend-cell" style="background: #7a6faa;"></div>
                
                <div style="writing-mode: vertical-rl; font-size: 12px;">Med MH</div>
                <div class="legend-cell" style="background: #dfb0d6;"></div>
                <div class="legend-cell" style="background: #a5add3;"></div>
                <div class="legend-cell" style="background: #5698b9;"></div>
                
                <div style="writing-mode: vertical-rl; font-size: 12px;">Good MH</div>
                <div class="legend-cell" style="background: #e8e8e8;"></div>
                <div class="legend-cell" style="background: #ace4e4;"></div>
                <div class="legend-cell" style="background: #5ac8c8;"></div>
                
                <div></div>
                <div class="legend-label" style="grid-column: 2/5; text-align: center; margin-top: 5px;">Social Exclusion</div>
            </div>
        </div>
        
        <div class="insights">
            <div class="insight">
                <h4>üîç Double Disadvantage (Dark Purple) - 40 Areas</h4>
                <p>Areas with both high social exclusion AND poor mental health outcomes - requiring comprehensive, targeted interventions addressing structural inequalities and mental health support.</p>
            </div>
            <div class="insight">
                <h4>üí™ Resilient Communities (Teal) - 23 Areas</h4>
                <p>Areas with high social exclusion but good mental health outcomes - understanding protective factors here could inform interventions elsewhere.</p>
            </div>
            <div class="insight">
                <h4>üéØ Most Advantaged (Light Grey) - 41 Areas</h4>
                <p>Areas with low social exclusion and good mental health - these communities demonstrate optimal conditions that could be models for policy development.</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([53.5, -2.5], 6);
        
        // Add base map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors | Mental Health Research'
        }).addTo(map);

        // Load and display boundary data
        fetch('./england_boundaries.geojson')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('GeoJSON data loaded successfully');
                
                // Add choropleth layer
                const geojsonLayer = L.geoJSON(data, {
                    style: function(feature) {
                        return {
                            fillColor: feature.properties.color || '#cccccc',
                            weight: 1,
                            opacity: 1,
                            color: 'white',
                            dashArray: '0',
                            fillOpacity: 0.8
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        const props = feature.properties;
                        
                        // Create popup content
                        const popupContent = `
                            <div style="font-family: Arial, sans-serif; max-width: 280px;">
                                <h3 style="margin: 0 0 10px 0; color: #333; border-bottom: 2px solid ${props.color}; padding-bottom: 5px;">
                                    ${props.name}
                                </h3>
                                <div style="display: grid; gap: 5px;">
                                    <p style="margin: 0;"><strong>Social Exclusion:</strong> ${props.exclusion ? props.exclusion.toFixed(3) : 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Mental Health (GHQ):</strong> ${props.mh ? props.mh.toFixed(2) : 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Sample Size:</strong> ${props.n || 'N/A'}</p>
                                    <div style="margin-top: 8px; padding: 5px; background: ${props.color}; color: white; border-radius: 3px; text-align: center; font-size: 12px; font-weight: bold;">
                                        Category: ${props.cat || 'N/A'}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        layer.bindPopup(popupContent);
                        
                        // Add hover effects
                        layer.on({
                            mouseover: function(e) {
                                const layer = e.target;
                                layer.setStyle({
                                    weight: 3,
                                    color: '#333',
                                    dashArray: '',
                                    fillOpacity: 0.9
                                });
                                layer.bringToFront();
                            },
                            mouseout: function(e) {
                                geojsonLayer.resetStyle(e.target);
                            },
                            click: function(e) {
                                map.fitBounds(e.target.getBounds());
                            }
                        });
                    }
                }).addTo(map);
                
                // Fit map to data bounds
                map.fitBounds(geojsonLayer.getBounds());
                
                // Hide loading indicator
                document.getElementById('loadingDiv').style.display = 'none';
                
                console.log(`Choropleth map loaded with ${data.features.length} local authorities`);
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
                document.getElementById('loadingDiv').innerHTML = `
                    <div style="color: red;">
                        <strong>Error loading boundary data</strong><br>
                        Make sure 'england_boundaries.geojson' is uploaded to your repository.
                    </div>
                `;
            });
    </script>
</body>
</html>
